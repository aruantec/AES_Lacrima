<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:behaviors="using:AES_Controls.Behaviors"
             xmlns:composition="using:AES_Controls.Composition"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
			 xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
			 xmlns:vm="using:AES_Lacrima.ViewModels"
			 mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
             x:Class="AES_Lacrima.Views.Navigation.MusicListView"
             x:DataType="vm:MusicViewModel"
             ClipToBounds="False"
             Height="266">

    <!-- Sets the DataContext for the previewer -->
    <Design.DataContext>
        <vm:MusicViewModel/>
    </Design.DataContext>
	<!-- Music navigation content -->
	<Grid Background="Black" ClipToBounds="False">
		<!-- Album list -->
		<ScrollViewer HorizontalScrollBarVisibility="Auto"
					  VerticalScrollBarVisibility="Disabled"
                      Focusable="False"
					  Margin="0,20,0,10">
			<ListBox ItemsSource="{Binding AlbumList}" 
					 Background="Transparent" 
					 ClipToBounds="False"
					 SelectionMode="Multiple"
					 SelectedItem="{Binding SelectedAlbum, Mode=TwoWay}">
				<ListBox.Styles>
					<Style Selector="ListBoxItem">
						<Setter Property="ClipToBounds" Value="False"/>
						<Setter Property="Background" Value="Transparent"/>
						<Setter Property="BorderThickness" Value="0"/>
						<Setter Property="BorderBrush" Value="Transparent"/>
						<Setter Property="ContextMenu">
							<ContextMenu Background="#AA000000" BorderBrush="#44FFFFFF" BorderThickness="0.5" CornerRadius="8" Padding="0">
								<MenuItem Header="Open Folder" CornerRadius="8" Command="{Binding $parent[ListBox].DataContext.OpenFolderCommand}">
									<MenuItem.Icon>
										<Viewbox Width="32" Height="32" Stretch="Uniform">
											<Canvas Width="100" Height="100">
												<Rectangle Canvas.Left="2" Canvas.Top="2" Width="96" Height="96" RadiusX="22" RadiusY="22" Stroke="#CCFFFFFF" StrokeThickness="8" Fill="Transparent" />
												<Rectangle Canvas.Left="46" Canvas.Top="32" Width="8" Height="36" RadiusX="4" RadiusY="4" Fill="#CCFFFFFF" />
												<Rectangle Canvas.Left="32" Canvas.Top="46" Width="36" Height="8" RadiusX="4" RadiusY="4" Fill="#CCFFFFFF" />
											</Canvas>
										</Viewbox>
									</MenuItem.Icon>
								</MenuItem>
								<MenuItem Header="Delete Album" CornerRadius="8" Command="{Binding $parent[ListBox].DataContext.DeleteFolderCommand}" CommandParameter="{Binding}">
									<MenuItem.Icon>
										<Path Data="M6,19A2,2 0 0,0 8,21h8a2,2 0 0,0 2-2V7H6v12zM19,4h-3.5l-1-1h-5l-1,1H5v2h14V4z"
												Fill="#CCFFFFFF"
												Width="32"
												Height="32"
												Stretch="Uniform"/>
									</MenuItem.Icon>
								</MenuItem>
							</ContextMenu>
						</Setter>
						<Style Selector="^ /template/ ContentPresenter">
						<Setter Property="ClipToBounds" Value="False"/>
					</Style>
					<Style Selector="^ /template/ Border#LayoutRoot">
						<Setter Property="ClipToBounds" Value="False"/>
						<Setter Property="Background" Value="Transparent"/>
						<Setter Property="BorderBrush" Value="Transparent"/>
						<Setter Property="BorderThickness" Value="0"/>
					</Style>
					<Style Selector="^ /template/ Border">
						<Setter Property="Background" Value="Transparent"/>
						<Setter Property="BorderBrush" Value="Transparent"/>
						<Setter Property="BorderThickness" Value="0"/>
					</Style>
					<Style Selector="^ /template/ ContentPresenter">
						<Setter Property="Background" Value="Transparent"/>
						<Setter Property="BorderBrush" Value="Transparent"/>
						<Setter Property="BorderThickness" Value="0"/>
					</Style>
					</Style>
					<Style Selector="ListBoxItem:pointerover">
						<Setter Property="Background" Value="Transparent"/>
						<Setter Property="BorderBrush" Value="Transparent"/>
						<Setter Property="BorderThickness" Value="0"/>
					</Style>
					<Style Selector="ListBoxItem:selected">
						<Setter Property="Background" Value="Transparent"/>
						<Setter Property="BorderBrush" Value="Transparent"/>
						<Setter Property="BorderThickness" Value="0"/>
					</Style>
					<Style Selector="ListBoxItem:selected:pointerover">
						<Setter Property="Background" Value="Transparent"/>
						<Setter Property="BorderBrush" Value="Transparent"/>
						<Setter Property="BorderThickness" Value="0"/>
					</Style>
					<Style Selector="ListBoxItem:selected /template/ ContentPresenter">
						<Setter Property="Background" Value="Transparent"/>
					</Style>
					<Style Selector="ListBoxItem:pointerover /template/ ContentPresenter">
						<Setter Property="Background" Value="Transparent"/>
					</Style>
					<Style Selector="ListBoxItem:selected /template/ ContentPresenter Border#SelectionOverlay">
						<Setter Property="Opacity" Value="0"/>
					</Style>
					<Style Selector="ListBox /template/ ScrollContentPresenter">
						<Setter Property="ClipToBounds" Value="False"/>
					</Style>
					<Style Selector="ListBox /template/ ItemsPresenter">
						<Setter Property="ClipToBounds" Value="False"/>
					</Style>
					<Style Selector="ListBox /template/ ScrollViewer">
						<Setter Property="ClipToBounds" Value="False"/>
					</Style>
					<Style Selector="ListBox /template/ Border">
						<Setter Property="ClipToBounds" Value="False"/>
					</Style>
				</ListBox.Styles>
				<!-- Items template -->
				<ListBox.ItemTemplate>
					<DataTemplate>
						<Border CornerRadius="12" Margin="0,0,0,10" ClipToBounds="True" Background="Transparent">
							<Grid Width="240">
								<!-- Folder control -->
								<composition:FolderCompositionControl Name="{Binding Title}"
																	  Items="{Binding Children}"
																	  ClipToBounds="True"
																	  MaxVisibleCovers="3"/>
								<!-- Album title overlay -->
								<Border VerticalAlignment="Bottom" Height="50" Background="#CC000000" ClipToBounds="False">
									<TextBlock Text="{Binding Title}" Margin="5" HorizontalAlignment="Center" TextWrapping="Wrap" Foreground="White" FontSize="18"/>
								</Border>
							</Grid>
						</Border>
					</DataTemplate>
				</ListBox.ItemTemplate>

				<!-- Behaviors -->
				<Interaction.Behaviors>
					<ExecuteCommandOnDoubleTappedBehavior Command="{Binding OpenSelectedFolderCommand}"
														  CommandParameter="{Binding SelectedAlbum}"/>
                        
					<behaviors:ListboxItemDragBehavior DropCommand="{Binding DropCommand}"/>
				</Interaction.Behaviors>

				<!-- Items panel -->
				<ListBox.ItemsPanel>
					<ItemsPanelTemplate>
						<StackPanel Orientation="Horizontal" Margin="10,0,0,0" ClipToBounds="False"/>
					</ItemsPanelTemplate>
				</ListBox.ItemsPanel>
			</ListBox>
		</ScrollViewer>
		
		<!-- Context menu -->
		<Grid.ContextMenu>
			<ContextMenu Background="#AA000000" BorderBrush="#44FFFFFF" BorderThickness="0.5" CornerRadius="8" Padding="0">
				<MenuItem Header="Add" CornerRadius="8" Command="{Binding OpenFolderCommand}">
					<MenuItem.Icon>
						<Viewbox Width="32" Height="32" Stretch="Uniform">
							<Canvas Width="100" Height="100">
								<!-- Rounded frame -->
								<Rectangle Canvas.Left="2" Canvas.Top="2" Width="96" Height="96" RadiusX="22" RadiusY="22" Stroke="#CCFFFFFF" StrokeThickness="8" Fill="Transparent" />
								<!-- Central plus sign -->
								<Rectangle Canvas.Left="46" Canvas.Top="32" Width="8" Height="36" RadiusX="4" RadiusY="4" Fill="#CCFFFFFF" />
								<Rectangle Canvas.Left="32" Canvas.Top="46" Width="36" Height="8" RadiusX="4" RadiusY="4" Fill="#CCFFFFFF" />
							</Canvas>
						</Viewbox>
					</MenuItem.Icon>
				</MenuItem>
			</ContextMenu>
		</Grid.ContextMenu>
	</Grid>
</UserControl>
